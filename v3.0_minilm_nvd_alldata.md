---
CVE Severity Prediction Workflow ---

=== STAGE 1: DATA PREPARATION ===
Downloading sample Garak report...
âœ… Downloaded: data/3.0/garak/garak.report.jsonl
âœ… Garak report successfully converted to: data/3.0/garak/garak_report_flat.csv
---
Downloading: nvdcve-1.1-2002.json.gz
Downloading: nvdcve-1.1-2003.json.gz
Downloading: nvdcve-1.1-2004.json.gz
Downloading: nvdcve-1.1-2005.json.gz
Downloading: nvdcve-1.1-2006.json.gz
Downloading: nvdcve-1.1-2007.json.gz
Downloading: nvdcve-1.1-2008.json.gz
Downloading: nvdcve-1.1-2009.json.gz
Downloading: nvdcve-1.1-2010.json.gz
Downloading: nvdcve-1.1-2011.json.gz
Downloading: nvdcve-1.1-2012.json.gz
Downloading: nvdcve-1.1-2013.json.gz
Downloading: nvdcve-1.1-2014.json.gz
Downloading: nvdcve-1.1-2015.json.gz
Downloading: nvdcve-1.1-2016.json.gz
Downloading: nvdcve-1.1-2017.json.gz
Downloading: nvdcve-1.1-2018.json.gz
Downloading: nvdcve-1.1-2019.json.gz
...
Training on 146631 valid NVD entries. This is the correct number if data prep was successful.
Loading embedding model: 'all-MiniLM-L6-v2'...

Encoding all descriptions... (This may take a very long time)
Output is truncated. View as a scrollable element or open in a text editor. Adjust cell output settings...
Batches:   0%|          | 0/4583 [00:00<?, ?it/s]

Applying SMOTE to balance the training data...

--- Training Logistic Regression ---
              precision    recall  f1-score   support

    Critical       0.41      0.65      0.51      5673
        High       0.61      0.46      0.52     14218
         Low       0.07      0.62      0.13       714
      Medium       0.77      0.53      0.63     16053

    accuracy                           0.52     36658
   macro avg       0.47      0.56      0.45     36658
weighted avg       0.64      0.52      0.56     36658

--- Training Random Forest ---
              precision    recall  f1-score   support

    Critical       0.57      0.52      0.54      5673
        High       0.60      0.69      0.64     14218
         Low       0.41      0.25      0.31       714
      Medium       0.75      0.69      0.72     16053

    accuracy                           0.65     36658
...
weighted avg       0.66      0.65      0.65     36658

--- Training LightGBM (Tuned) ---
Output is truncated. View as a scrollable element or open in a text editor. Adjust cell output settings...
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 1.708017 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 97920
[LightGBM] [Info] Number of data points in the train set: 192628, number of used features: 384
[LightGBM] [Info] Start training from score -1.386294
[LightGBM] [Info] Start training from score -1.386294
[LightGBM] [Info] Start training from score -1.386294
[LightGBM] [Info] Start training from score -1.386294
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
              precision    recall  f1-score   support

    Critical       0.57      0.57      0.57      5673
        High       0.64      0.67      0.65     14218
         Low       0.40      0.25      0.30       714
      Medium       0.76      0.74      0.75     16053

    accuracy                           0.68     36658
   macro avg       0.59      0.56      0.57     36658
weighted avg       0.68      0.68      0.68     36658

ðŸ† Best performing model is: LightGBM (Tuned) with F1-Score: 0.6772
âœ… Best model saved to models/3.0/best_cvss_classifier_historic.pkl

=== STAGE 3: PREDICTION ===

--- Prediction on Garak Report ---
Embedding Garak report for prediction...
Batches:   0%|          | 0/190 [00:00<?, ?it/s]
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
âœ… Predictions saved to data/3.0/garak/garak_with_severity_historic.csv

--- Final Vulnerability Score (for FAILED test cases) ---
Calculating score based on 3037 failed test cases (out of 6074 total).

Severity Distribution (of Failures):
predicted_severity
Medium      2208
High         826
Critical       3
Name: count, dtype: int64

Total Raw Risk Score (from Failures): 14644
Normalized Report Vulnerability Score (0-100): 48.22

--- Workflow Finished ---
