--- CVE Severity Prediction Workflow ---

=== STAGE 1: DATA PREPARATION ===
Downloading sample Garak report...
✅ Downloaded: data/5.0/garak/garak.report.jsonl
✅ Garak report successfully converted to: data/5.0/garak/garak_report_flat.csv
--- Starting NVD Data Download ---
Downloading: nvdcve-1.1-2002.json.gz
Downloading: nvdcve-1.1-2003.json.gz
Downloading: nvdcve-1.1-2004.json.gz
Downloading: nvdcve-1.1-2005.json.gz
Downloading: nvdcve-1.1-2006.json.gz
Downloading: nvdcve-1.1-2007.json.gz
Downloading: nvdcve-1.1-2008.json.gz
Downloading: nvdcve-1.1-2009.json.gz
Downloading: nvdcve-1.1-2010.json.gz
Downloading: nvdcve-1.1-2011.json.gz
Downloading: nvdcve-1.1-2012.json.gz
Downloading: nvdcve-1.1-2013.json.gz
Downloading: nvdcve-1.1-2014.json.gz
Downloading: nvdcve-1.1-2015.json.gz
Downloading: nvdcve-1.1-2016.json.gz
Downloading: nvdcve-1.1-2017.json.gz
Downloading: nvdcve-1.1-2018.json.gz
Downloading: nvdcve-1.1-2019.json.gz
...
Name: count, dtype: int64

Loading embedding model: 'all-mpnet-base-v2'...
Encoding all descriptions from the balanced dataset...
Output is truncated. View as a scrollable element or open in a text editor. Adjust cell output settings...
Batches:   0%|          | 0/357 [00:00<?, ?it/s]

Training on 8565 samples, testing on 2855 samples.

--- Training Logistic Regression ---
              precision    recall  f1-score   support

    Critical       0.65      0.74      0.69       714
        High       0.53      0.49      0.51       713
         Low       0.73      0.70      0.71       714
      Medium       0.64      0.64      0.64       714

    accuracy                           0.64      2855
   macro avg       0.64      0.64      0.64      2855
weighted avg       0.64      0.64      0.64      2855


--- Training Random Forest ---
              precision    recall  f1-score   support

    Critical       0.69      0.68      0.69       714
        High       0.56      0.50      0.53       713
         Low       0.67      0.77      0.72       714
      Medium       0.67      0.65      0.66       714

    accuracy                           0.65      2855
...
weighted avg       0.65      0.65      0.65      2855


--- Training LightGBM (Tuned) ---
Output is truncated. View as a scrollable element or open in a text editor. Adjust cell output settings...
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.168445 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 195840
[LightGBM] [Info] Number of data points in the train set: 8565, number of used features: 768
[LightGBM] [Info] Start training from score -1.386411
[LightGBM] [Info] Start training from score -1.385944
[LightGBM] [Info] Start training from score -1.386411
[LightGBM] [Info] Start training from score -1.386411
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
              precision    recall  f1-score   support

    Critical       0.72      0.75      0.73       714
        High       0.59      0.57      0.58       713
         Low       0.75      0.76      0.76       714
      Medium       0.71      0.70      0.71       714

    accuracy                           0.69      2855
   macro avg       0.69      0.69      0.69      2855
weighted avg       0.69      0.69      0.69      2855


🏆 Best performing model is: LightGBM (Tuned) with F1-Score: 0.6940
✅ Best model saved to models/5.0/best_cvss_classifier_historic.pkl

=== STAGE 3: PREDICTION ===

--- Prediction on Garak Report ---
Embedding Garak report for prediction...
Batches:   0%|          | 0/190 [00:00<?, ?it/s]
/usr/local/lib/python3.11/dist-packages/sklearn/utils/deprecation.py:151: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
  warnings.warn(
✅ Predictions saved to data/5.0/garak/garak_with_severity_historic.csv

--- Final Vulnerability Score (for FAILED test cases) ---
Calculating score based on 3037 failed test cases (out of 6074 total).

Severity Distribution (of Failures):
predicted_severity
Low         2867
High          85
Medium        60
Critical      25
Name: count, dtype: int64

Total Raw Risk Score (from Failures): 3952
Normalized Report Vulnerability Score (0-100): 13.01

--- Workflow Finished ---